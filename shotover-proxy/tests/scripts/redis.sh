#!/usr/bin/env bash
set -e

# Get the script dir no matter where we exec this script from
SCRIPT_DIR="$(cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

# Create a defered function to cleanup docker-compose. This also preserves the exit code before the trap was hit
# and returns that instead. So if our tests fails, our CI system will still pick it up!

function defer {
	docker-compose -f $SCRIPT_DIR/../../tests/test-configs/redis-cluster/docker-compose.yaml down
}

trap defer EXIT

docker-compose -f $SCRIPT_DIR/../../tests/test-configs/redis-cluster/docker-compose.yaml up

#cargo run -- --topology-file $SCRIPT_DIR/../../tests/test-configs/redis-cluster/topology.yaml --config-file $SCRIPT_DIR/../../config/config.yaml


