@version: 4.8
@include "scl.conf"

source s_network {
    tcp(port(601));
};

destination d_local_1 {
	file(
	    "/var/log/syslog.json"
	    template("$(format-json --scope rfc3164 --scope nv-pairs)\n\n")
	);
};

parser p_json {
    json_parser();
};

destination d_local_2 {
	file(
	    "/var/log/syslog"
	    template("${DATE} An emergency message (${content.message}; type ${type}) has shown up.\n")
	);
};

log {
	source(s_network);
	parser(p_json);
	destination(d_local_1);
	if (match("emergency" value("content.level"))) {
	    destination(d_local_2);
	};
};